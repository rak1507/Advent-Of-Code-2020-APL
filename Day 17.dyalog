a←'#'=↑⊃⎕NGET 'Day 17.txt' 1
pad←{⍵@(1+⍳⍴⍵)⊢0⍴⍨2+⍴⍵}

⍝ Part 1
+/,{⊃1 ⍵∨.∧3 4=⊂{+/,⍵}⌺3 3 3⊢⍵}∘pad⍣6⊢(↑,∘⊂)a

⍝ Part 2
+/,{⊃1 ⍵∨.∧3 4=⊂{+/,⍵}⌺3 3 3 3⊢⍵}∘pad⍣6⊢(↑,∘⊂)⍣2⊢a
