a←'#'=↑⊃⎕NGET 'Day 17.txt' 1

⍝ Part 1
pad←{0,[2]0,[2]⍨0⍪0⍪⍨0,0,⍨⍵}
+/,{⊃1 ⍵∨.∧3 4=⊂{+/,⍵}⌺3 3 3⊢⍵}∘pad⍣6⊢(↑,∘⊂)a

⍝ Part 2
pad←{0,[3]0,[3]⍨0,[2]0,[2]⍨0⍪0⍪⍨0,0,⍨⍵}
+/,{⊃1 ⍵∨.∧3 4=⊂{+/,⍵}⌺3 3 3 3⊢⍵}∘pad⍣6⊢(↑,∘⊂)⍣2⊢a
