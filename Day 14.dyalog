a←⊃⎕NGET'Day 14.txt' 1 ⋄ X←2 ⋄ ⎕FR←1287 ⋄ ⎕PP←20
masks←n⌿↑⍎¨¨3⊃¨' '(≠⊆⊢)¨m/a⊣n←1-⍨¯2-/⍸1,⍨m←'X'∊¨a
(mems n)←↓⍉↑⍎¨⊃,/'mem\[(\d+)\] = (\d+)'⎕S'\1,\2'¨a

⍝ Part 1
+/mems{⊃⌽⍵}⌸2⊥⍉masks{(⍺×⍺≠2)+(⍵×⍺=2)}⍤1⊢1↓⍉2⊥⍣¯1⊢(2*35),n

⍝ Part 2
+/(n/⍨2*+/2=masks){⊃⌽⍵}⌸⍨2⊥⍉{⍵⌿⍨0≠+/⍵},[1 2](1↓⍉2⊥⍣¯1⊢mems,⍨2*35){(⍺∨⍵)⊣@(⍸2=⍵)⍤1⍨⍉2⊥⍣¯1⊢1-⍨⍳2*2+.=⍵}⍤1⊢masks
